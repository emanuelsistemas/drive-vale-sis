{"ast":null,"code":"import { supabase } from './supabase';\n\n/**\n * Função para criar as tabelas necessárias no Supabase caso não existam\n */\nexport const createRequiredTables = async () => {\n  try {\n    // Verificar se a tabela dv_restricao_user existe\n    const {\n      data: restricaoExists,\n      error: restricaoCheckError\n    } = await supabase.from('dv_restricao_user').select('id').limit(1);\n\n    // Se ocorrer um erro, provavelmente a tabela não existe\n    if (restricaoCheckError) {\n      console.log('Criando tabela dv_restricao_user...');\n\n      // Criar a tabela dv_restricao_user\n      const createRestricaoTableQuery = `\n        CREATE TABLE IF NOT EXISTS dv_restricao_user (\n          id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n          dv_tipo_restricao TEXT CHECK (dv_tipo_restricao IN ('admin', 'user')) DEFAULT 'admin'\n        );\n      `;\n      const {\n        error: createRestricaoError\n      } = await supabase.rpc('exec', {\n        query: createRestricaoTableQuery\n      });\n      if (createRestricaoError) {\n        console.error('Erro ao criar tabela dv_restricao_user:', createRestricaoError);\n      } else {\n        console.log('Tabela dv_restricao_user criada com sucesso!');\n      }\n    }\n\n    // Verificar se a tabela dv_cad_empresas_drive existe\n    const {\n      data: empresasExists,\n      error: empresasCheckError\n    } = await supabase.from('dv_cad_empresas_drive').select('id').limit(1);\n\n    // Se ocorrer um erro, provavelmente a tabela não existe\n    if (empresasCheckError) {\n      console.log('Criando tabela dv_cad_empresas_drive...');\n\n      // Criar a tabela dv_cad_empresas_drive\n      const createEmpresasTableQuery = `\n        CREATE TABLE IF NOT EXISTS dv_cad_empresas_drive (\n          id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n          dv_nome TEXT,\n          dv_email TEXT,\n          dv_senha TEXT,\n          dv_tipo_restricao BIGINT REFERENCES dv_restricao_user(id)\n        );\n      `;\n      const {\n        error: createEmpresasError\n      } = await supabase.rpc('exec', {\n        query: createEmpresasTableQuery\n      });\n      if (createEmpresasError) {\n        console.error('Erro ao criar tabela dv_cad_empresas_drive:', createEmpresasError);\n      } else {\n        console.log('Tabela dv_cad_empresas_drive criada com sucesso!');\n      }\n    }\n    return {\n      success: true\n    };\n  } catch (error) {\n    console.error('Erro ao criar tabelas:', error);\n    return {\n      success: false,\n      error\n    };\n  }\n};\nexport default createRequiredTables;","map":{"version":3,"names":["supabase","createRequiredTables","data","restricaoExists","error","restricaoCheckError","from","select","limit","console","log","createRestricaoTableQuery","createRestricaoError","rpc","query","empresasExists","empresasCheckError","createEmpresasTableQuery","createEmpresasError","success"],"sources":["/root/m-software/drive-react/src/services/createTables.ts"],"sourcesContent":["import { supabase } from './supabase';\n\n/**\n * Função para criar as tabelas necessárias no Supabase caso não existam\n */\nexport const createRequiredTables = async () => {\n  try {\n    // Verificar se a tabela dv_restricao_user existe\n    const { data: restricaoExists, error: restricaoCheckError } = await supabase\n      .from('dv_restricao_user')\n      .select('id')\n      .limit(1);\n    \n    // Se ocorrer um erro, provavelmente a tabela não existe\n    if (restricaoCheckError) {\n      console.log('Criando tabela dv_restricao_user...');\n      \n      // Criar a tabela dv_restricao_user\n      const createRestricaoTableQuery = `\n        CREATE TABLE IF NOT EXISTS dv_restricao_user (\n          id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n          dv_tipo_restricao TEXT CHECK (dv_tipo_restricao IN ('admin', 'user')) DEFAULT 'admin'\n        );\n      `;\n      \n      const { error: createRestricaoError } = await supabase.rpc('exec', { \n        query: createRestricaoTableQuery \n      });\n      \n      if (createRestricaoError) {\n        console.error('Erro ao criar tabela dv_restricao_user:', createRestricaoError);\n      } else {\n        console.log('Tabela dv_restricao_user criada com sucesso!');\n      }\n    }\n    \n    // Verificar se a tabela dv_cad_empresas_drive existe\n    const { data: empresasExists, error: empresasCheckError } = await supabase\n      .from('dv_cad_empresas_drive')\n      .select('id')\n      .limit(1);\n    \n    // Se ocorrer um erro, provavelmente a tabela não existe\n    if (empresasCheckError) {\n      console.log('Criando tabela dv_cad_empresas_drive...');\n      \n      // Criar a tabela dv_cad_empresas_drive\n      const createEmpresasTableQuery = `\n        CREATE TABLE IF NOT EXISTS dv_cad_empresas_drive (\n          id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n          dv_nome TEXT,\n          dv_email TEXT,\n          dv_senha TEXT,\n          dv_tipo_restricao BIGINT REFERENCES dv_restricao_user(id)\n        );\n      `;\n      \n      const { error: createEmpresasError } = await supabase.rpc('exec', { \n        query: createEmpresasTableQuery \n      });\n      \n      if (createEmpresasError) {\n        console.error('Erro ao criar tabela dv_cad_empresas_drive:', createEmpresasError);\n      } else {\n        console.log('Tabela dv_cad_empresas_drive criada com sucesso!');\n      }\n    }\n    \n    return { success: true };\n  } catch (error) {\n    console.error('Erro ao criar tabelas:', error);\n    return { success: false, error };\n  }\n};\n\nexport default createRequiredTables;\n"],"mappings":"AAAA,SAASA,QAAQ,QAAQ,YAAY;;AAErC;AACA;AACA;AACA,OAAO,MAAMC,oBAAoB,GAAG,MAAAA,CAAA,KAAY;EAC9C,IAAI;IACF;IACA,MAAM;MAAEC,IAAI,EAAEC,eAAe;MAAEC,KAAK,EAAEC;IAAoB,CAAC,GAAG,MAAML,QAAQ,CACzEM,IAAI,CAAC,mBAAmB,CAAC,CACzBC,MAAM,CAAC,IAAI,CAAC,CACZC,KAAK,CAAC,CAAC,CAAC;;IAEX;IACA,IAAIH,mBAAmB,EAAE;MACvBI,OAAO,CAACC,GAAG,CAAC,qCAAqC,CAAC;;MAElD;MACA,MAAMC,yBAAyB,GAAG;AACxC;AACA;AACA;AACA;AACA,OAAO;MAED,MAAM;QAAEP,KAAK,EAAEQ;MAAqB,CAAC,GAAG,MAAMZ,QAAQ,CAACa,GAAG,CAAC,MAAM,EAAE;QACjEC,KAAK,EAAEH;MACT,CAAC,CAAC;MAEF,IAAIC,oBAAoB,EAAE;QACxBH,OAAO,CAACL,KAAK,CAAC,yCAAyC,EAAEQ,oBAAoB,CAAC;MAChF,CAAC,MAAM;QACLH,OAAO,CAACC,GAAG,CAAC,8CAA8C,CAAC;MAC7D;IACF;;IAEA;IACA,MAAM;MAAER,IAAI,EAAEa,cAAc;MAAEX,KAAK,EAAEY;IAAmB,CAAC,GAAG,MAAMhB,QAAQ,CACvEM,IAAI,CAAC,uBAAuB,CAAC,CAC7BC,MAAM,CAAC,IAAI,CAAC,CACZC,KAAK,CAAC,CAAC,CAAC;;IAEX;IACA,IAAIQ,kBAAkB,EAAE;MACtBP,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC;;MAEtD;MACA,MAAMO,wBAAwB,GAAG;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;MAED,MAAM;QAAEb,KAAK,EAAEc;MAAoB,CAAC,GAAG,MAAMlB,QAAQ,CAACa,GAAG,CAAC,MAAM,EAAE;QAChEC,KAAK,EAAEG;MACT,CAAC,CAAC;MAEF,IAAIC,mBAAmB,EAAE;QACvBT,OAAO,CAACL,KAAK,CAAC,6CAA6C,EAAEc,mBAAmB,CAAC;MACnF,CAAC,MAAM;QACLT,OAAO,CAACC,GAAG,CAAC,kDAAkD,CAAC;MACjE;IACF;IAEA,OAAO;MAAES,OAAO,EAAE;IAAK,CAAC;EAC1B,CAAC,CAAC,OAAOf,KAAK,EAAE;IACdK,OAAO,CAACL,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;IAC9C,OAAO;MAAEe,OAAO,EAAE,KAAK;MAAEf;IAAM,CAAC;EAClC;AACF,CAAC;AAED,eAAeH,oBAAoB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}