{"ast":null,"code":"import{useState,useEffect}from'react';import{useAuth}from'../contexts/AuthContext';import{useToast}from'../contexts/ToastContext';import{uploadFile,listFiles,deleteFile,getFileUrl}from'../services/fileService';export const useFiles=()=>{const{user}=useAuth();const{showToast}=useToast();const[files,setFiles]=useState([]);const[loading,setLoading]=useState(true);const[uploading,setUploading]=useState(false);useEffect(()=>{if(user){fetchFiles();}},[user]);const fetchFiles=async()=>{if(!user)return;try{setLoading(true);const fileList=await listFiles(user.id);setFiles(fileList);}catch(error){console.error('Erro ao buscar arquivos:',error);showToast('Erro ao carregar arquivos','error');}finally{setLoading(false);}};const handleUpload=async file=>{if(!user)return;try{setUploading(true);const newFile=await uploadFile(file,user.id);setFiles(prev=>[newFile,...prev]);showToast('Arquivo enviado com sucesso!');return newFile;}catch(error){console.error('Erro ao fazer upload:',error);showToast('Erro ao enviar arquivo','error');throw error;}finally{setUploading(false);}};const handleDelete=async(fileId,filePath)=>{try{await deleteFile(fileId,filePath);setFiles(prev=>prev.filter(file=>file.id!==fileId));showToast('Arquivo excluído com sucesso!');return true;}catch(error){console.error('Erro ao excluir arquivo:',error);showToast('Erro ao excluir arquivo','error');throw error;}};const getDownloadUrl=async filePath=>{try{return await getFileUrl(filePath);}catch(error){console.error('Erro ao obter URL de download:',error);showToast('Erro ao gerar link de download','error');throw error;}};return{files,loading,uploading,fetchFiles,handleUpload,handleDelete,getDownloadUrl};};","map":{"version":3,"names":["useState","useEffect","useAuth","useToast","uploadFile","listFiles","deleteFile","getFileUrl","useFiles","user","showToast","files","setFiles","loading","setLoading","uploading","setUploading","fetchFiles","fileList","id","error","console","handleUpload","file","newFile","prev","handleDelete","fileId","filePath","filter","getDownloadUrl"],"sources":["/root/m-software/drive-react/src/hooks/useFiles.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { useToast } from '../contexts/ToastContext';\nimport { uploadFile, listFiles, deleteFile, getFileUrl } from '../services/fileService';\nimport { FileObject } from '../types/supabase';\n\nexport const useFiles = () => {\n  const { user } = useAuth();\n  const { showToast } = useToast();\n  \n  const [files, setFiles] = useState<FileObject[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [uploading, setUploading] = useState(false);\n  \n  useEffect(() => {\n    if (user) {\n      fetchFiles();\n    }\n  }, [user]);\n  \n  const fetchFiles = async () => {\n    if (!user) return;\n    \n    try {\n      setLoading(true);\n      const fileList = await listFiles(user.id);\n      setFiles(fileList);\n    } catch (error) {\n      console.error('Erro ao buscar arquivos:', error);\n      showToast('Erro ao carregar arquivos', 'error');\n    } finally {\n      setLoading(false);\n    }\n  };\n  \n  const handleUpload = async (file: File) => {\n    if (!user) return;\n    \n    try {\n      setUploading(true);\n      const newFile = await uploadFile(file, user.id);\n      setFiles(prev => [newFile, ...prev]);\n      showToast('Arquivo enviado com sucesso!');\n      return newFile;\n    } catch (error) {\n      console.error('Erro ao fazer upload:', error);\n      showToast('Erro ao enviar arquivo', 'error');\n      throw error;\n    } finally {\n      setUploading(false);\n    }\n  };\n  \n  const handleDelete = async (fileId: string, filePath: string) => {\n    try {\n      await deleteFile(fileId, filePath);\n      setFiles(prev => prev.filter(file => file.id !== fileId));\n      showToast('Arquivo excluído com sucesso!');\n      return true;\n    } catch (error) {\n      console.error('Erro ao excluir arquivo:', error);\n      showToast('Erro ao excluir arquivo', 'error');\n      throw error;\n    }\n  };\n  \n  const getDownloadUrl = async (filePath: string) => {\n    try {\n      return await getFileUrl(filePath);\n    } catch (error) {\n      console.error('Erro ao obter URL de download:', error);\n      showToast('Erro ao gerar link de download', 'error');\n      throw error;\n    }\n  };\n  \n  return {\n    files,\n    loading,\n    uploading,\n    fetchFiles,\n    handleUpload,\n    handleDelete,\n    getDownloadUrl\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}